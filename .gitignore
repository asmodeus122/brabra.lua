local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local LocalPlayer = Players.LocalPlayer
local Character = LocalPlayer.Character or LocalPlayer.CharacterAdded:Wait()
local Humanoid = Character:WaitForChild("Humanoid")
local StarterGui = game:GetService("StarterGui")

local config = {
    esp = true,
    instantSteal = false,
    autoTP = false,
    safeZone = true,
    noclip = false,
    brainrotFolder = workspace:WaitForChild("Brainrots"),
    distanceSteal = 15,
    stealDelay = 0.05
}

local function criarESP(obj)
    if obj:FindFirstChild("Highlight") or not config.esp then return end
    local highlight = Instance.new("Highlight")
    highlight.FillColor = Color3.fromRGB(0, 255, 0)
    highlight.OutlineColor = Color3.fromRGB(255, 255, 255)
    highlight.FillTransparency = 0.25
    highlight.OutlineTransparency = 0
    highlight.Parent = obj
end

local function roubarBrainrot(brainrot)
    if not brainrot or not brainrot:IsDescendantOf(workspace) then return end
    if (brainrot.Position - Character.PrimaryPart.Position).Magnitude <= config.distanceSteal then
        local prompt = brainrot:FindFirstChildWhichIsA("ProximityPrompt")
        if prompt then
            -- Para mobile, tente usar: prompt:InputHoldBegin() e InputHoldEnd()
            prompt:InputHoldBegin()
            task.wait(0.1)
            prompt:InputHoldEnd()
        end
    end
end

local function teleportarParaMaisProximo()
    local maisProximo, menorDistancia = nil, math.huge
    for _, brainrot in pairs(config.brainrotFolder:GetChildren()) do
        if brainrot:IsA("BasePart") then
            local distancia = (brainrot.Position - Character.PrimaryPart.Position).Magnitude
            if distancia < menorDistancia then
                maisProximo = brainrot
                menorDistancia = distancia
            end
        end
    end
    if maisProximo then
        Character:SetPrimaryPartCFrame(CFrame.new(maisProximo.Position + Vector3.new(0, 2, 0)))
    end
end

if config.noclip then
    RunService.Stepped:Connect(function()
        for _, part in ipairs(Character:GetDescendants()) do
            if part:IsA("BasePart") and part.CanCollide == true then
                part.CanCollide = false
            end
        end
    end)
end

RunService.RenderStepped:Connect(function()
    for _, brainrot in pairs(config.brainrotFolder:GetChildren()) do
        if brainrot:IsA("BasePart") then
            criarESP(brainrot)
        end
    end

    if config.autoTP then
        teleportarParaMaisProximo()
    end

    if config.instantSteal then
        for _, brainrot in pairs(config.brainrotFolder:GetChildren()) do
            if brainrot:IsA("BasePart") then
                roubarBrainrot(brainrot)
                task.wait(config.stealDelay)
            end
        end
    end
end)

if config.safeZone then
    Humanoid.PlatformStand = true
end

-- Criar GUI para controlar no mobile
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "StealBrainrotControls"
screenGui.ResetOnSpawn = false
screenGui.Parent = LocalPlayer:WaitForChild("PlayerGui")

local function criarBotao(texto, posY, ativar, desativar)
    local btn = Instance.new("TextButton")
    btn.Size = UDim2.new(0, 120, 0, 40)
    btn.Position = UDim2.new(0, 10, 0, posY)
    btn.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
    btn.TextColor3 = Color3.new(1,1,1)
    btn.Text = texto .. ": OFF"
    btn.Parent = screenGui
    btn.Active = true
    btn.AutoButtonColor = true

    local ligado = false
    btn.MouseButton1Click:Connect(function()
        ligado = not ligado
        if ligado then
            btn.Text = texto .. ": ON"
            ativar()
        else
            btn.Text = texto .. ": OFF"
            desativar()
        end
    end)
end

criarBotao("Noclip", 10,
    function()
        config.noclip = true
        RunService.Stepped:Connect(function()
            for _, part in ipairs(Character:GetDescendants()) do
                if part:IsA("BasePart") and part.CanCollide == true then
                    part.CanCollide = false
                end
            end
        end)
    end,
    function()
        config.noclip = false
        for _, part in ipairs(Character:GetDescendants()) do
            if part:IsA("BasePart") then
                part.CanCollide = true
            end
        end
    end
)

criarBotao("Auto TP", 60,
    function() config.autoTP = true end,
    function() config.autoTP = false end
)

criarBotao("Auto Steal", 110,
    function() config.instantSteal = true end,
    function() config.instantSteal = false end
)
